# The Y-64 class-two architecture reference manual

## Scope

This manual describes the Y-64 processor and system-on-chip internals for Lunota / OSMORA
chip and firmware engineers. This manual also describes various component interfaces.

## Terminology

```
Processing domain)
    A processing domain (PD) is a single processor core [unit of execution]
    consisting of its own register bank, ALU, control unit, etc.

Bootstrap PD)
    The bootstrap processing domain is the first processing domain to be brought
    up when the system is powered up.

PC inhibit line)
    Describes an electrical connection to a processing domain that results in
    the program counter being held if set.
```

## Machine power-up state

When power is driven to the SoC, the RESET signal is immediately asserted to the
bootstrap processing domain. This in turn results in all registers (excluding FP,
SP, TT, and control registers) being initialized to a fixed bit-pattern [0x1A1F1A1F1A1F1A1F].

All control registers as well as the stack pointer (SP) and frame pointer (FP) are to
be initialized to zero. The program counter register is to be initialized to a value of
zero which is mapped to external SPI flash or internal ROM depending on the chip series.

All other processing domains are to have their PC inhibit line asserted until woken up by
the bootstrap processing domain.

## Memory map listing

```
START         END           PURPOSE
-------------------------------------------------------
0x000000    0x100000      BIOS FLASH ROM
0x100000    0x110000      PD LOCAL CACHE
0x110000    0x111000      CHIPSET REGISTERS
0x111000    0x116000      RESERVED
0x116000    MAXIMUM RAM   USABLE MEMORY
-------------------------------------------------------
```

### Chipset registers


```
BYTE          NAME               PURPOSE
-------------------------------------------------------
0             MEMCTL         Memory control register
10:1          SPICTL         SPI control register
-------------------------------------------------------
```

### Chipset memory control register


```
BITS          NAME               PURPOSE
-------------------------------------------------------
0            CG                Cache gate
7:2          Reserved          Reserved for future use
-------------------------------------------------------
```

The ``CG`` bit enables access to external RAM during early init, writes of zero are ignored.
If a written value of 1 does not stick, platform firmware is to assume the lack of external
RAM.

### SPI control register

```
BITS          NAME      PURPOSE
-------------------------------------------------------
63:0         PRPD       Physical address of PRPD
71:64        CtlStat    Control and status register
-------------------------------------------------------
```

To initiate an SPI transaction to a specific device, system software is to write the
physical address of a physical region page descriptor (PRPD) to the PRPD field of the
SPI control register. The SPI controller is to respond by setting the BUSY bit in the
control and status register followed by clearing the PRPD field. System software is not
to write to the PRPD field if the controller is busy or undefined behavior is expected.

### SPI control register - PRPD

```
BITS          NAME      PURPOSE                     R/W
-----------------------------------------------------------
0            Reserved   Reserved for future use     [N/A]
1            Busy       Controller busy if set      [R]
-----------------------------------------------------------
```

### SPI control register - PRPD layout

```
BITS          NAME          PURPOSE
-----------------------------------------------------------
63:0          BufPhys      Physical buffer address
65:64         Length       Length of buffer
73:66         ChipSel      Chip select / device ID
74            Write        If set, operation is a write
-----------------------------------------------------------
```

### SPI control register - valid device IDs

```
ID          NAME
-----------------------------------------------------------
0x00        On-board SD-card reader
0xFF        Reserved
-----------------------------------------------------------
```

### SPI control register - CtlStat

```
BITS          NAME      PURPOSE                     R/W
-----------------------------------------------------------
0            Reserved   Reserved for future use     [N/A]
1            Busy       Controller busy if set      [R]
-----------------------------------------------------------
```
